<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GT Marketplace - Admin Register Log</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7fafc; margin: 0; padding: 0; }
        .container { max-width: 800px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.07); padding: 32px; }
        h1 { text-align: center; color: #4a5568; margin-bottom: 32px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 10px; border-bottom: 1px solid #e2e8f0; text-align: left; }
        th { background: #667eea; color: #fff; }
        tr:last-child td { border-bottom: none; }
        .no-data { text-align: center; color: #888; padding: 40px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Daftar Register per IP & MAC</h1>
        <div id="logTable"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="js/supabase.js"></script>
    <script>
    async function fetchRegisterLogs() {
        // Ambil semua log
        const { data, error } = await supabase
            .from('register_logs')
            .select('ip_address, mac_address');

        if (error || !data || data.length === 0) {
            document.getElementById('logTable').innerHTML = '<div class="no-data">Belum ada data register.</div>';
            return;
        }

        // Kelompokkan berdasarkan ip_address & mac_address
        const grouped = {};
        data.forEach(row => {
            const key = row.ip_address + '|' + row.mac_address;
            if (!grouped[key]) {
                grouped[key] = { ip_address: row.ip_address, mac_address: row.mac_address, jumlah: 0 };
            }
            grouped[key].jumlah++;
        });

        // Ubah ke array dan urutkan desc
        const logs = Object.values(grouped).sort((a, b) => b.jumlah - a.jumlah);

        // Tampilkan tabel
        let html = `
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>IP Address</th>
                        <th>MAC Address</th>
                        <th>Jumlah Register</th>
                    </tr>
                </thead>
                <tbody>
                    ${logs.map((row, i) => `
                        <tr>
                            <td>${i+1}</td>
                            <td>${row.ip_address}</td>
                            <td>${row.mac_address}</td>
                            <td>${row.jumlah}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
        document.getElementById('logTable').innerHTML = html;
    }

    fetchRegisterLogs();
    </script>
</body>
</html>